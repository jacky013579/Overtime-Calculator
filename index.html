<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>響應式工時計算機</title>
    <style>
        /* == 基礎樣式 (Mobile-First / 手機版) == */
        body { font-family: 'Microsoft JhengHei', sans-serif; background-color: #f0f2f5; padding: 10px; }
        .container { 
            max-width: 500px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1); 
        }
        h2 { text-align: center; color: #333; margin-bottom: 20px; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
        .section { margin-bottom: 30px; padding: 15px; background: #fff; border: 1px solid #ddd; border-radius: 10px; }
        .section-title { font-size: 1.2em; font-weight: bold; margin-bottom: 15px; display: block; }
        
        /* 輸入欄位通用樣式 (手機版垂直堆疊) */
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        input[type="time"], input[type="number"] { 
            width: 100%; 
            padding: 12px; 
            margin-bottom: 15px; 
            border: 1px solid #ccc; 
            border-radius: 8px; 
            font-size: 18px; 
            box-sizing: border-box; /* 重要：防止 padding 撐大寬度 */
        }
        
        button { 
            width: 100%; 
            padding: 15px; 
            border: none; 
            border-radius: 8px; 
            font-size: 18px; 
            cursor: pointer; 
            font-weight: bold; 
            transition: background 0.3s;
        }
        .btn-blue { background-color: #007bff; color: white; }
        .btn-green { background-color: #28a745; color: white; }
        .btn-blue:hover { background-color: #0056b3; }
        .btn-green:hover { background-color: #1e7e34; }

        .result-area { margin-top: 15px; padding: 15px; background-color: #e8f5e9; border: 1px solid #81c784; border-radius: 8px; display: none; text-align: center; }
        .result-detail { text-align: left; font-size: 16px; line-height: 1.6; color: #333; }
        .highlight-pay { color: #dc3545; font-weight: bold; font-size: 1.2em; }
        .highlight-comp { color: #007bff; font-weight: bold; font-size: 1.2em; }

        /* == 響應式佈局 (Media Query for Desktop) == */
        @media (min-width: 768px) {
            .container {
                max-width: 700px; /* 增加電腦版容器寬度 */
            }
            .input-group {
                display: flex;
                gap: 20px;
                align-items: flex-start; /* 讓內容靠上對齊 */
            }
            .input-item {
                flex-grow: 1; /* 讓每個輸入項佔據相等寬度 */
                width: 50%;
            }
            .input-item label, .input-item input {
                width: 100%; /* 確保內部元素充滿空間 */
            }
            /* 電腦版按鈕可以變窄一點 */
            button {
                margin-top: 10px; 
                width: 100%;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h2>⏰ 響應式工時計算機</h2>
    <p style="text-align: center; font-size: 14px; color: #888;">螢幕寬時欄位並排，螢幕窄時欄位堆疊。</p>

    <div class="section">
        <span class="section-title" style="color: #0056b3;">1. 計算最晚下班時間</span>
        <div class="input-group">
            <div class="input-item">
                <label>上班打卡時間：</label>
                <input type="time" id="startTime">
            </div>
            <div class="input-item">
                <label>工作時數 (預設12)：</label>
                <input type="number" id="workHours" value="12">
            </div>
        </div>
        
        <button onclick="runLeave()" class="btn-blue">計算下班時間</button>
        
        <div id="leaveRes" class="result-area">
            最晚下班時間：
            <div style="font-size: 24px; font-weight: bold; color: #007bff;" id="leaveTimeDisplay">--:--</div>
        </div>
    </div>

    <div class="section">
        <span class="section-title" style="color: #28a745;">2. 加班與補休計算</span>
        <p style="font-size: 12px; color: #888; margin-bottom: 15px;">補休僅計算 **23:00 - 07:00** 之間的夜間工時。</p>
        
        <div class="input-group">
            <div class="input-item">
                <label>加班開始時間：</label>
                <input type="time" id="otStart">
            </div>
            <div class="input-item">
                <label>加班結束時間：</label>
                <input type="time" id="otEnd">
            </div>
        </div>

        <button onclick="runOT()" class="btn-green">計算時數</button>

        <div id="otRes" class="result-area">
             <div class="result-detail">
                實際總時長：<span id="txtTime" style="font-weight: bold;"></span><br>
                實際夜間工時：<span id="txtNightTime" style="font-weight: bold;"></span>
                <hr style="opacity: 0.3; margin: 10px 0;">
                <div style="text-align: center;">
                    加班申報：<b class="highlight-pay" id="txtPay">0</b> 小時<br>
                    補休時數：<b class="highlight-comp" id="txtComp">0</b> 小時
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// === 核心邏輯（沿用上次的正確計算規則） ===

// 通用函數：計算兩段時間的重疊分鐘數
function getIntersectionMins(startA, endA, startB, endB) {
    if (!startA || !endA || !startB || !endB) return 0;
    
    let intersectStart = Math.max(startA.getTime(), startB.getTime());
    let intersectEnd = Math.min(endA.getTime(), endB.getTime());

    if (intersectEnd > intersectStart) {
        return (intersectEnd - intersectStart) / 60000;
    }
    return 0;
}

// 1. 計算下班時間
function runLeave() {
    let start = document.getElementById('startTime').value;
    let hrs = parseFloat(document.getElementById('workHours').value);
    
    if(!start || !hrs) {
        document.getElementById('leaveRes').style.display = 'block';
        document.getElementById('leaveTimeDisplay').innerHTML = '<span style="color:red;">請輸入上班時間與時數！</span>';
        return;
    }
    
    let d = new Date('2000-01-01T' + start);
    let originalDate = d.getDate();
    d.setMinutes(d.getMinutes() + hrs * 60);
    
    let h = d.getHours().toString().padStart(2,'0');
    let m = d.getMinutes().toString().padStart(2,'0');
    
    let nextDay = (d.getDate() > originalDate) ? '<span style="font-size:14px; color:gray;">(隔日) </span>' : '';
    
    document.getElementById('leaveRes').style.display = 'block';
    document.getElementById('leaveTimeDisplay').innerHTML = `${nextDay}${h}:${m}`;
}

// 2. 計算加班與補休
function runOT() {
    let s = document.getElementById('otStart').value;
    let e = document.getElementById('otEnd').value;
    
    if(!s || !e) {
        document.getElementById('otRes').style.display = 'none';
        return alert('請輸入完整時間');
    }

    let d1 = new Date('2000-01-01T' + s);
    let d2 = new Date('2000-01-01T' + e);
    
    if(d2 < d1) d2.setDate(d2.getDate() + 1); // 處理跨日

    let diffMins = (d2 - d1) / 60000;
    if(diffMins <= 0) return alert('結束時間需晚於開始時間');

    let realHours = diffMins / 60;

    // --- 加班申報時數 ---
    let finalPay = 0;
    if (realHours <= 2) {
        finalPay = 2; // 開頭2小時低消
    } else {
        finalPay = Math.ceil(realHours); // 超過2小時無條件進位
    }
    
    // --- 補休時數 (僅計算 23:00 - 07:00 時段) ---
    let nightWorkMins = 0;

    // 區間 A: 當日晚間 (23:00 - 24:00/00:00)
    let night1Start = new Date(d1); night1Start.setHours(23, 0, 0, 0);
    let night1End = new Date(d1); night1End.setDate(night1End.getDate() + 1); night1End.setHours(0, 0, 0, 0);
    nightWorkMins += getIntersectionMins(d1, d2, night1Start, night1End);

    // 區間 B: 隔日清晨 (00:00 - 07:00)
    let night2Start = new Date(d1); night2Start.setDate(night2Start.getDate() + 1); night2Start.setHours(0, 0, 0, 0);
    let night2End = new Date(night2Start); night2End.setHours(7, 0, 0, 0);
    nightWorkMins += getIntersectionMins(d1, d2, night2Start, night2End);
    
    let nightWorkHours = nightWorkMins / 60;

    // 補休規則：2小時級距 (上限8小時)
    let finalComp = 0;
    if (nightWorkHours > 0) {
        if (nightWorkHours >= 8) {
             finalComp = 8;
        } else {
             finalComp = Math.ceil(nightWorkHours / 2) * 2;
        }
    }
    
    // 輸出格式化
    let displayH = Math.floor(diffMins / 60);
    let displayM = diffMins % 60;
    let nightDisplayH = Math.floor(nightWorkMins / 60);
    let nightDisplayM = nightWorkMins % 60;

    document.getElementById('otRes').style.display = 'block';
    document.getElementById('txtTime').innerText = `${displayH} 小時 ${displayM} 分`;
    document.getElementById('txtNightTime').innerText = `${nightDisplayH} 小時 ${nightDisplayM} 分`;
    document.getElementById('txtPay').innerText = finalPay;
    document.getElementById('txtComp').innerText = finalComp;
}
</script>
</body>
</html>
